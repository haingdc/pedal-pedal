---
title: Import subpath LÃ m nhÆ° tháº¿ nÃ o?
date: '2025-07-05'
tags: ['publish npm', 'Deno', 'Storybook', 'Lit', 'Typescript', 'Lit-ts', 'Web Components', 'ReactJs', 'NextJs', 'Vite', 'import subpath']
draft: false
summary:
---

Trong quÃ¡ trÃ¬nh xÃ¢y dá»±ng trang web, ta sáº½ tháº¥y Ä‘Ã¢u Ä‘Ã³ viá»‡c import tá»›i thÃ nh pháº§n con sá»­ dá»¥ng subpath:

```ts
// Sá»­ dá»¥ng import sub path
import Foo from 'library-ui/foo'

// Thay vÃ¬
import { Foo } from 'library-ui'
```

Äiá»u nÃ y giÃºp cÃ¡c cÃ´ng cá»¥ biÃªn dá»‹ch, Ä‘Ã³ng gÃ³i code dá»… dÃ ng hÆ¡n Ä‘Ã³ng gÃ³i pháº§n code Ä‘á»§ Ä‘á»ƒ á»©ng dá»¥ng cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng tá»‘t, loáº¡i bá» code dÆ° thá»«a. Qua Ä‘Ã³ giáº£m thiá»ƒu kÃ­ch thÆ°á»›c cÃ¡c táº­p tin. BÃ i nÃ y chÃºng ta sáº½ tÃ¬m hiá»ƒu cÃ¡ch mÃ  thÆ° viá»‡n há»— trá»£ kháº£ nÄƒng import qua Ä‘Æ°á»ng dáº«n con.

BÃ i viáº¿t gá»“m 3 pháº§n chÃ­nh
- Cáº¥u trÃºc thÆ° má»¥c cho cÃ¡c component
- Cáº­p nháº­t cÃ¡c file cÃ i Ä‘áº·t
- DÃ²ng thá»i gian trong thá»­ nghiá»‡m

# Cáº¥u trÃºc thÆ° má»¥c cho cÃ¡c component

DÆ°á»›i Ä‘Ã¢y lÃ  cáº¥u trÃºc sourcecode:

```text
ğŸ“ src
  - ğŸ“ count-down
    - ğŸ“ count-display.ts
	- ğŸ“ count-down.ts
  - ğŸ“ count-down-gang
    - ğŸ“ count-down-gang.ts
  - ğŸ“ index.ts
```

ChÆ°Æ¡ng trÃ¬nh cá»§a chÃºng ta cÃ³ 2 loáº¡i count down, má»™t loáº¡i sáº½ chÃ o Ä‘áº¡i loáº¡i lÃ  "Hello, Tuáº¥n!". CÃ²n loáº¡i kia sáº½ lÃ  "Hello Gang, Tuáº¥n!". Khi click vÃ o Count down thÃ¬ Ä‘á»u Ä‘áº¿m ngÆ°á»£c vÃ  káº¿t quáº£ Ä‘Æ°á»£c hiá»ƒn thá»‹ thÃ´ng qua component count-display. Ráº¥t Ä‘Æ¡n giáº£n vÃ  dá»… dÃ ng! 

Count-display ngáº¯n gá»n chá»‰ láº¥y giÃ¡ trá»‹ tá»« property Ä‘á»ƒ hiá»ƒn thá»‹:

```ts
import { html, LitElement } from "lit";
import { customElement } from "lit/decorators.js";

@customElement("count-display")
class CountDisplay extends LitElement {
  static override properties = {
    count: { type: Number },
  };
  declare count: number;
  constructor() {
    super();
  }

  override render() {
    return html`
      <p>Count: ${this.count}</p>
    `;
  }
}
```

Count-down sáº½ dÃ i hÆ¡n chÃºt:

```ts
import { css, html, LitElement } from "lit";
import { customElement } from "lit/decorators.js";
import "./count-display.ts";

@customElement("count-down")
class CountDown extends LitElement {
  static override styles = css`
    div {
      border: 1px solid black;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    @media (prefers-color-scheme: dark) {
      div {
        border-color: white;
      }
    }

    span {
      color: rebeccapurple;
    }

    p {
      font-family: sans-serif;
    }
  `;

  static override properties = {
    name: { type: String },
    count: { type: Number },
  };
  declare name: string;
  declare count: number;
  constructor() {
    super();

    this.count = 0;
    this.name = "Somebody";
  }

  private handleClick() {
    this.dispatchEvent(
      new CustomEvent("Decrease", {
        bubbles: true,
        composed: true,
        detail: {
          current_count: this.count,
        },
      }),
    );
  }

  override render() {
    return html`
      <div>
        <p>Hello, ${this.name}!</p>
        <button @click="${this.handleClick}">Count down</button>
        <count-display .count="${this.count}"></count-display>
      </div>
    `;
  }
}
```

CÃ³ má»™t sá»‘ Ä‘iá»ƒm lÆ°u Ã½ trong component nÃ y

Äiá»ƒm Ä‘áº§u tiÃªn, click vÃ o button Count down, NÃ³ sáº½ dispatchEvent "Decrease". Event Ä‘Æ°á»£c táº¡o ra lÃ  CustomEvent, nÃ³ lÃ  Web API vÃ  cÃ³ máº·t á»Ÿ cáº£ NodeJs vÃ  Deno.

Äiá»ƒm thá»© hai lÃ  cÃ¡ch ta import count-display á»Ÿ dáº¡ng side effect import. ÄÃ¢y lÃ  cÃ¡ch Ä‘Æ°á»£c sá»­ dá»¥ng trong Lit. VÃ  sau Ä‘Ã³ ta cÃ³ thá»ƒ sá»­ dá»¥ng `<count-display></count-display>` khi render.

NhÃ¢n tiá»‡n, tÃ´i sáº½ giá»›i thiá»‡u 4 kiá»ƒu khai bÃ¡o import cá»§a ESM lÃ :

```js
// a. Named import
import { export1, export2 } from "module-name";

// b.Default immport
import defaultExport from "module-name";

// c. Namespace import
import * as name from "module-name";

// d. Side effect import
import "module-name";
```

Äiá»ƒm thá»© ba lÃ  decorator `@customElement("count-down")`. NÃ³ sáº½ Ä‘Äƒng kÃ½ global customElement tÃªn "count-down". ÄÃ¢y chÃ­nh lÃ  side effect nÃªn giáº£i thÃ­ch cho viá»‡c ta sáº½ sá»­ dá»¥ng side effect import cho count-display.

Cuá»‘i cÃ¹ng, trÃªn trÃ¬nh duyá»‡t ta cÃ³ thá»ƒ sá»­ dá»¥ng count-down nhÆ° má»™t tháº» bÃ¬nh thÆ°á»ng:

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + Lit + TS</title>
    <link rel="stylesheet" href="./src/index.css" />
    <script type="module" src="/src/count-down/count-down.ts"></script>
  </head>
  <body>
    <count-down name="Brown" count="27"></count-down>
    <script>
      const countDown = document.querySelector("count-down");
      countDown.addEventListener("Decrease", (event) => {
        countDown.count = event.detail.current_count - 1;
      });
    </script>
  </body>
</html>

```

Count-display-gang tÆ°Æ¡ng tá»± Count-down.

BÃ¢y giá» nÃ³i vá» pháº§n chÃ­nh cá»§a bÃ i, cho phÃ©p import sub path.

# Cáº­p nháº­t cÃ¡c file cÃ i Ä‘áº·t

ChÃºng ta sáº½ cáº§n qui Ä‘á»‹nh code á»Ÿ cÃ¡c file: package.json, vite.config.ts.

## ChÃºng ta báº¯t Ä‘áº§u tá»« vite.config.ts

```ts {8-13, 15}
import { defineConfig } from "vite";

// https://vitejs.dev/config/
export default defineConfig({
  build: {
    sourcemap: false,
    lib: {
      entry: {
        index: "src/index.ts",
        "count-display": "src/count-down/count-display.ts",
        "count-down": "src/count-down/count-down.ts",
        "count-down-gang": "src/count-down-gang/count-down-gang.ts",
      },
      formats: ["es"],
      fileName: (_format, entryName) => `${entryName}.es.js`,
    },
    rollupOptions: {
      external: [
        /^lit/,
      ],
      output: {
        preserveModules: false,
        exports: "auto",
      },
    },
  },
});

```

Giáº£i thÃ­ch:

1. Entry
	 ChÃºng ta sáº½ táº¡o nhiá»u entry khÃ¡c nhau thay vÃ¬ 1. Äiá»u nÃ y cho phÃ©p ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ import sub path.

2. FileName
	GiÃºp táº¡o cÃ¡c file cÃ³ tÃªn vá»›i Ä‘uÃ´i `.es.js` nhÆ° count-down.es.js, v.v.

## Tiáº¿p tá»›i lÃ  vite.config.ts

```ts {8-13, 15}
import { defineConfig } from "vite";

// https://vitejs.dev/config/
export default defineConfig({
  build: {
    sourcemap: false,
    lib: {
      entry: {
        index: "src/index.ts",
        "count-display": "src/count-down/count-display.ts",
        "count-down": "src/count-down/count-down.ts",
        "count-down-gang": "src/count-down-gang/count-down-gang.ts",
      },
      formats: ["es"],
      fileName: (_format, entryName) => `${entryName}.es.js`,
    },
    rollupOptions: {
      external: [
        /^lit/,
      ],
      output: {
        preserveModules: false, // náº¿u set lÃ  true thÃ¬ count-display.ts cÃ³ thá»ƒ khÃ´ng Ä‘Æ°á»£c bundle trong dist/count-down.es.js
        exports: "auto",
      },
    },
  },
});

```

Giáº£i thÃ­ch:

1. Entry
	 ChÃºng ta sáº½ táº¡o nhiá»u entry khÃ¡c nhau thay vÃ¬ 1. Äiá»u nÃ y cho phÃ©p ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ import sub path.

2. FileName
	GiÃºp táº¡o cÃ¡c file cÃ³ tÃªn vá»›i Ä‘uÃ´i `.es.js` nhÆ° count-down.es.js, v.v. package.json:

```json {3, 5-27}
{
  "name": "lesson-02-how-import-components-separately-instead-of-whole-library",
  "private": false,
  "version": "0.0.0",
  "type": "module",
  "exports": {
    ".": {
      "types": "./types/index.d.ts",
      "import": "./dist/index.es.js",
      "default": "./dist/index.es.js"
    },
    "./count-down": {
      "types": "./types/count-down/count-down.d.ts",
      "import": "./dist/count-down.es.js",
      "default": "./dist/count-down.es.js"
    },
    "./count-down-gang": {
      "types": "./types/count-down-gang/count-down-gang.d.ts",
      "import": "./dist/count-down-gang.es.js",
      "default": "./dist/count-down-gang.es.js"
    }
  },
  "sideEffects": [
    "./src/count-down/count-display.ts",
    "./dist/count-display.es.js"
  ],
  "types": "types/index.d.ts",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "storybook": "storybook dev -p 6006",
    "build-storybook": "storybook build"
  },
  "devDependencies": {
    "@chromatic-com/storybook": "^4.0.1",
    "@storybook/addon-a11y": "^9.0.15",
    "@storybook/addon-docs": "^9.0.15",
    "@storybook/addon-vitest": "^9.0.15",
    "@storybook/web-components-vite": "^9.0.15",
    "@vitest/browser": "^3.2.4",
    "@vitest/coverage-v8": "^3.2.4",
    "lit": "^3.3.0",
    "playwright": "^1.53.2",
    "storybook": "^9.0.15",
    "typescript": "~5.8.3",
    "vite": "^7.0.0",
    "vitest": "^3.2.4"
  },
  "peerDependencies": {
    "lit": "^3.3.0"
  }
}
```

Giáº£i thÃ­ch:

1. Private false
   ÄÆ¡n giáº£n hoÃ¡ viá»‡c Ä‘Æ°a code lÃªn NPM vÃ  sá»­ dá»¥ng ta táº¡o public package.
2. Type "module"
   Qui Ä‘á»‹nh thÆ° viá»‡n cÃ³ kiá»ƒu module. XÃ¢y dá»±ng vá»›i 1 kiá»ƒu duy nháº¥t lÃ  Module sáº½ Ä‘á»¡ hÆ¡n kiá»ƒu CommonJs hoáº·c cáº£ 2 kiá»ƒu. Äá»“ng thá»i, kiá»ƒu Module cÅ©ng quen thuá»™c vá»›i nhiá»u ngÆ°á»i.
4. Exports
   ÄÃ¢y lÃ  nÆ¡i chÃºng ta qui Ä‘á»‹nh cÃ¡c subpath cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng
   
   Pháº§n tá»­ Ä‘áº§u tiÃªn lÃ  Ä‘Æ°á»ng dáº«n gá»‘c. Láº§n lÆ°á»£t tiáº¿p theo lÃ  cÃ¡c Ä‘Æ°á»ng dáº«n con count-down, count-down-gang. Má»—i pháº§n tá»­ gá»“m 3 pháº§n types, import, default. ChÃºng sáº½ chá»©a Ä‘Æ°á»ng dáº«n á»Ÿ thÆ° má»¥c ğŸ“ dist vÃ  ğŸ“ types.

6. SideEffects
   Báº¡n sáº½ tháº¥y á»Ÿ exports ta khÃ´ng qui Ä‘á»‹nh sub path count-display. ÄÃ³ lÃ  chá»§ Ã½. Ta cung cáº¥p count-down vÃ  count-down-gang Ä‘á»ƒ ngÆ°á»i dÃ¹ng sá»­ dá»¥ng. BÃªn trong nÃ³ cÃ³ dÃ¹ng count-display hay khÃ´ng thÃ¬ há» khÃ´ng cáº§n quan tÃ¢m.
   GiÃ¡ trá»‹ cá»§a sideEffects lÃ  "count-display" tá»›i tá»« ğŸ“ src vÃ  ğŸ“ dist. Vite á»Ÿ trong thÆ° viá»‡n vÃ  bundler á»Ÿ phÃ­a ngÆ°á»i dÃ¹ng nhÆ° (Webpack, Vite, Turbopack, v.v.) sáº½ biáº¿t Ä‘Æ°á»£c lÃ  "A! Ta pháº£i Ä‘Ã³ng gÃ³i code cá»§a count-display vÃ¬ nÃ³ lÃ  side effect". Vite trong thÆ° viá»‡n sáº½ tháº¥y giÃ¡ trá»‹ count-display á»Ÿ ğŸ“ src vÃ  táº¡o lá»‡nh import cho ğŸ“ dist/count-down.es.js vÃ  ğŸ“ dist/count-down-gang.es.js.

   HÃ£y thá»­ thiáº¿t láº­p sideEffects lÃ  false vÃ  bá» entry lÃ  count-display trong vite.config.ts. Káº¿t quáº£ lÃ  ğŸ“ dist chá»© count-down vÃ  count-down-gang sáº½ khÃ´ng cÃ³ lá»‡nh import count-display

Váº­y lÃ  tÃ´i vÃ  cÃ¡c báº¡n Ä‘Ã£ hoÃ n thÃ nh viá»‡c qui Ä‘á»‹nh import sub path. Tá»›i Ä‘Ã¢y chÃºng ta cÃ³ thá»ƒ build code báº±ng lá»‡nh `deno task build-deno` Ä‘á»ƒ kiá»ƒm tra. Náº¿u Okay chÃºng ta sáº½ thá»±c thi `deno task bump-patch` vÃ  cuá»‘i cÃ¹ng Ä‘Æ°a lÃªn NPM `deno task publish-npm`.

# DÃ²ng thá»i gian trong thá»­ nghiá»‡m

TÃ¬m hiá»ƒu cÃ¡ch táº¡o 1 thÆ° viá»‡n sáº½ cáº§n nhiá»u thá»­ nghiá»‡m Ä‘á»ƒ hiá»ƒu cÃ¡ch cÃ¡c bÃªn liÃªn káº¿t vá»›i nhau. Qua Ä‘Ã¢y tÃ´i rÃºt ra sau vÃ i láº§n thá»­ nghiá»‡m:

1. Láº¦N I
	VÃ­ dá»¥ ban Ä‘áº§u gá»“m count-down vÃ  count-display, entry cÃ³ count-down, sideEffects khÃ´ng Ä‘Æ°á»£c qui Ä‘á»‹nh. SideEffects khÃ´ng qui Ä‘á»‹nh Ä‘á»“ng nghÄ©a vá»›i viá»‡c cÃ¡c bundler tá»± quyáº¿t Ä‘á»‹nh chá»— nÃ o lÃ  sideEffects chá»© khÃ´ng pháº£i máº·c Ä‘á»‹nh lÃ  false nha!

2. Láº¦N II
	TÃ´i thá»­ vá»›i count-down vÃ  count-display, entry cÃ³ count-down vÃ  sideEffects lÃ  "./src/count-down/count-display.ts". Káº¿t quáº£ cho ra file count-down.es.js chá»©a code cá»§a count-display trong nÃ³.

	ğŸ¤– Suy nghÄ© cá»§a Vite cÃ³ thá»ƒ lÃ  count-display khÃ´ng cÃ³ nhiá»u code, vÃ  cÅ©ng chá»‰ Ä‘Æ°á»£c dÃ¹ng cho count-down tháº¿ thÃ¬ ta nÃªn Ä‘Ã³ng gÃ³i cáº£ nÃ³ vÃ o trong file count-down!

	ğŸ˜ Äiá»u nÃ y lÃ m tÃ´i nghÄ© tá»›i Láº¦N III, náº¿u cÃ³ thÃªm count-down-gang vÃ  nÃ³ sáº½ phá»¥ thuá»™c vÃ o count-display. Liá»‡u káº¿t quáº£ sáº½ lÃ  file count-down-gang.es.js sáº½ cÃ³ code count-display trong nÃ³. Äiá»u nÃ y hoÃ n toÃ n gÃ¢y trÃ¹ng láº·p code á»Ÿ hai loáº¡i count down!

3. Láº¦N III
	CÃ³ count-down, count-display, count-down-gang, entry cÃ³ count-down vÃ  count-down-gang, sideEffects khÃ´ng Ä‘á»ƒ.

   Káº¿t quáº£ trong count-down.es.js vÃ  count-down-gang.es.js láº§n lÆ°á»£t cÃ³ side effect import tá»›i file "count-display-Dpg0kpmd.js". MÃ£ Dpg0kpmd sáº½ khÃ¡c nhau tuá»³ lÃºc build.

	ğŸ˜ KhÃ´ng cÃ³ chuyá»‡n trÃ¹ng láº·p code á»Ÿ cáº£ 2 count down. Vite xÃ¡c Ä‘á»‹nh lÃ  cáº£ 2 anh Ä‘á»u phá»¥ thuá»™c vÃ o count-display nÃªn cho ra 1 file riÃªng. VÃ  vÃ¬ khÃ´ng qui Ä‘á»‹nh trong entry nÃªn file nÃ y má»›i cÃ³ thÃªm mÃ£ bÄƒm Dpg0kpmd. Váº­y lÃ  sideEffects dÃ¹ khÃ´ng qui Ä‘á»‹nh nhÆ°ng Ä‘Æ°á»£c Vite luáº­n ra lÃ  sáº½ cáº§n import nÃ³ cho count down. DÃ¹ váº­y ta váº«n NÃªn thÃªm "./src/count-down/count-display.ts" vÃ o sideEffects cho rÃµ rÃ ng.

4. Láº¦N IV (NÆ I Sá»¬ Dá»¤NG - NEXTJS)
   Tiáº¿p tá»¥c tá»« Láº¦N III, tÃ´i bá»• sung sideEffects cÃ³ giÃ¡ trá»‹ "./src/count-down/count-display.ts" vÃ  Ä‘áº©y lÃªn NPM. Sau Ä‘Ã³ táº¡o chÆ°Æ¡ng trÃ¬nh NextJs version 15 vÃ  cÃ i thÆ° viá»‡n cá»§a mÃ¬nh. TÃ´i nháº­n ra count-display khÃ´ng hiá»ƒn thá»‹. Sau khi tÃ¬m hiá»ƒu thÃ¬ ra váº¥n Ä‘á» lÃ  bundler cá»§a NextJs khÃ´ng nghÄ© count-display lÃ  side effect nÃªn loáº¡i bá» nÃ³ Ä‘i.

   ğŸ’¡ Giáº£i phÃ¡p lÃ  trá»Ÿ vá» thÆ° viá»‡n, thÃªm vÃ o entry count-display trong vite.config.ts thÃ¬ nÃ³ sáº½ cho ta file ğŸ“ dist/count-display.es.js. Sau Ä‘Ã³ tÃ´i thÃªm Ä‘Æ°á»ng dáº«n file nÃ y vÃ o sideEffects. Äáº©y lÃªn NPM vÃ  kiá»ƒm tra. Láº§n nÃ y NextJs nháº­n diá»‡n thÃ nh cÃ´ng, count-display Ä‘Æ°á»£c hiá»ƒn thá»‹.

Tá»›i Ä‘Ã¢y cÅ©ng lÃ  Ä‘iá»ƒm káº¿t thÃºc cá»§a bÃ i viáº¿t! Háº¹n gáº·p láº¡i cÃ¡c báº¡n